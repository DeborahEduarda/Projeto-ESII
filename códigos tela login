package br.com.tenisclube.telas;
import java.sql.*;
import br.com.tenisclube.dal.ModuloConexao;
import java.awt.Color;
import javax.swing.JOptionPane;
/**
 *
 * @author debor
 */
public class TelaLogin extends javax.swing.JFrame {
    Connection conexao = null;
    PreparedStatement pst = null;
    ResultSet rs = null;
    
    public void logar(){
            
        String sql = "select * from tbusuarios where login = ? and senha = ?";
            
        try{
            // as linhas abaixo preparam as consultas ao banco em funcao
            // do que foi digitado nas caixas de texto. Os ? é substituido pelo
            //conteudo das variaveis
            pst = conexao.prepareStatement(sql);
            pst.setString(1,txtUsuario.getText());
            String captura = new String(txtSenha.getPassword());
            pst.setString(2,captura);
            // a linha abaixo executa a Query
            rs = pst.executeQuery();
         	// se existir usuario e senha correspondente
   	 	    //abaixo vai abrir a tela principal se a senha estiver certa
                if (rs.next()){
                   //a linha abaixo obtem o conteudo do campo perfil da tabela tbusuario
                   String perfil=rs.getString(6);
                   //System.out.println(perfil);
                   //a estrutura abaixo faz o tratamento do perfil do usuario
                   if (perfil.equals ("HU 13 a 15 - Relatorios"))
                       {
                        //abaixo vai abrir a tela principal se o usuario e senha estiver certa
                        TelaPrincipal principal = new TelaPrincipal();
                        principal.setVisible(true);
                        //Linha abaixo permissões de acesso
                        TelaPrincipal.MenRel.setEnabled(true);
                        TelaPrincipal.menCadUsu.setEnabled(true);
                        TelaPrincipal.menCadQua.setEnabled(true);
                        TelaPrincipal.menCadManut.setEnabled(true);
                        //abaixo imprime na tela quem é o usuario que esta acessando
                        TelaPrincipal.lblUsuario.setText(rs.getString(2));
                        TelaPrincipal.jlblPerfil.setText(rs.getString(6));
                        // abaixo mudar a cor da letra quando for adm
                        TelaPrincipal.lblUsuario.setForeground(Color.RED);
                        this.dispose();
                        conexao.close();                           
                       }
          
                       else if (perfil.equals ("HU 1 a 6 - gerir de quadras"))
                           {
                            //abaixo vai abrir a tela principal se o usuario e senha estiver certa
                            TelaPrincipal principal = new TelaPrincipal();
                            principal.setVisible(true);
                            //Linha abaixo permissões de acesso                          
                            TelaPrincipal.menCadQua.setEnabled(true);
                            TelaPrincipal.menCadManut.setEnabled(true);
                            //abaixo imprime na tela quem é o usuario que esta acessando
                            TelaPrincipal.lblUsuario.setText(rs.getString(2));
                            TelaPrincipal.jlblPerfil.setText(rs.getString(6));
                            // abaixo mudar a cor da letra quando for adm
                            TelaPrincipal.lblUsuario.setForeground(Color.BLUE);
                            this.dispose();
                            conexao.close();       
                            }
                            
                           else if (perfil.equals ( "HU 7 a 12 - gerir de usuarios"))
                               {
                               //abaixo vai abrir a tela principal se o usuario e senha estiver certa
                               TelaPrincipal principal = new TelaPrincipal();
                               principal.setVisible(true);
                               //Linha abaixo permissões de acesso
                               TelaPrincipal.menCadUsu.setEnabled(true);
                               //abaixo imprime na tela quem é o usuario que esta acessando
                               TelaPrincipal.lblUsuario.setText(rs.getString(2));
                               TelaPrincipal.jlblPerfil.setText(rs.getString(6));
                               // abaixo mudar a cor da letra quando for adm
                               TelaPrincipal.lblUsuario.setForeground(Color.GREEN);
                               this.dispose();
                               conexao.close();
                               }
                               else 
                                   {
                                    //abaixo vai abrir a tela principal se o usuario e senha estiver certa
                                    TelaPrincipal principal = new TelaPrincipal();
                                    principal.setVisible(true);
                                    //Linha abaixo permissões de acesso
                                    TelaPrincipal.menCadQua.setEnabled(true);
                                    TelaPrincipal.menCadManut.setEnabled(true);
                                    TelaPrincipal.menCadUsu.setEnabled(true);
                                    //abaixo imprime na tela quem é o usuario que esta acessando
                                    TelaPrincipal.lblUsuario.setText(rs.getString(2));
                                    TelaPrincipal.jlblPerfil.setText(rs.getString(6));
                                    // abaixo mudar a cor da letra quando for adm
                                    TelaPrincipal.lblUsuario.setForeground(Color.YELLOW);
                                    this.dispose();
                                    conexao.close();
                                   }

               
                   
                   }else {

                        JOptionPane.showMessageDialog(null,"usuario e/ou senha invalido(s)");
                    }


            }catch (Exception e){
                JOptionPane.showMessageDialog(null,e);
            }
          
        
    /**
     * Creates new form TelaLogin
     */
     public TelaLogin(){
        initComponents();
        conexao = ModuloConexao.conector();
        //a linha abaixo serve de apoio ao status da conexao
        System.out.println(conexao);
        if (conexao != null){
            //lblStatus.setText("conectado");
            lblStatus.setIcon(new javax.swing.ImageIcon(getClass(). getResource("/br/com/tenisclube/icones/dbyes.png")));
        }else{
            //lblStatus.setText("Não conectado");
             lblStatus.setIcon(new javax.swing.ImageIcon(getClass(). getResource("/br/com/tenisclube/icones/dbno.png")));
        }
        }

    
               

    private void btnLoginActionPerformed(java.awt.event.ActionEvent evt) {                                         
        // chamando o metodo logar
        logar();
        
    }                                        

                        
}
